NAME	= minishell

# Compilation 

CC 		= clang
CFLAGS	= -Wall -Wextra -Werror -I${LIB_DIR} -I${READLINE_DIR}
RM		= rm -f

# Colors
YELLOW	= \033[1;33m
GREEN	= \033[1;32m
BLUE	= \033[0;36m
DEFAULT	= \033[0;0m

# Dependencies

READLINE_DIR = ~/.brew/opt/readline/include
FTS_DIR = src/
OBJ_DIR	= obj/
LIB_DIR = inc/
FTS		= $(wildcard src/*/*.c)
OBJS	= $(patsubst ${FTS_DIR}%.c, ${OBJ_DIR}%.o, ${FTS})
DEPENDS	:= $(OBJS:.o=.d)

${OBJ_DIR}%.o:	${FTS_DIR}%.c
		@mkdir -p ${@D}
		@${CC} ${CFLAGS} -MMD -MP -c $< -o $@

# Rules

${NAME}:	${OBJS}
		@echo "${BLUE} [Make] ${YELLOW} Building !"
		@make -C ./libft/
		
		$(CC) ${CFLAGS} -o $@ $^ -L libft/ -lft -lreadline
		@echo "${BLUE} [Make] ${GREEN} Done. ${DEFAULT}"

all:	${NAME}

clean:
		@echo "${BLUE} [Make] ${YELLOW} Cleaning !"
		@make -C ./libft/ clean
		@${RM} ${OBJS}
		@echo "${BLUE} [Make] ${GREEN} Done. ${DEFAULT}"

fclean:
		@echo "${BLUE} [Make] ${YELLOW} Full Cleaning !"
		@make -C ./libft/ fclean
		@${RM} ${NAME} ${OBJS}
		@echo "${BLUE} [Make] ${GREEN} Done. ${DEFAULT}"

re: fclean all

leaks: 	${NAME}
		valgrind --leak-check=full --show-leak-kinds=all --suppressions=ignore_readline.supp -s ./$(NAME)

-include $(DEPENDS)

.PHONY: all clean fclean re